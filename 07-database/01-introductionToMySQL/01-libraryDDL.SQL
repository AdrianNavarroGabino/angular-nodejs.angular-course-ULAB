-- Adri√°n Navarro Gabino

CREATE TABLE AUTORES
(
    COD VARCHAR(10) NOT NULL,
    NOMBRE VARCHAR(60),
    CONSTRAINT PK_AUTORES PRIMARY KEY (COD)
);

CREATE TABLE LIBROS
(
    COD VARCHAR(10) NOT NULL,
    ISBN VARCHAR(20) NOT NULL,
    TITULO VARCHAR(100),
    PRECIO INT,
    URL VARCHAR(100),
    IMAGEN VARCHAR(100),
    COD_AUTOR VARCHAR(10),
    CONSTRAINT PK_LIBROS PRIMARY KEY (COD),
    CONSTRAINT UK_ISBN UNIQUE KEY (ISBN),
    CONSTRAINT FK_LIBROS_AUTORES FOREIGN KEY (COD_AUTOR) REFERENCES AUTORES(COD)
);

CREATE TABLE EJEMPLAR
(
    COD VARCHAR(10) NOT NULL,
    LOCALIZACION VARCHAR(20),
    VERSION VARCHAR(20),
    COD_LIBRO VARCHAR(10) NOT NULL,
    CONSTRAINT PK_EJEMPLAR PRIMARY KEY (COD),
    CONSTRAINT FK_EJEMPLAR_LIBROS FOREIGN KEY (COD_LIBRO) REFERENCES LIBROS(COD)
);

CREATE TABLE USUARIOS
(
    COD VARCHAR(10) NOT NULL,
    NOMBRE VARCHAR(60),
    CUENTA VARCHAR(20),
    DIRECCION VARCHAR(100),
    TELEFONO VARCHAR(12),
    CONSTRAINT PK_USUARIOS PRIMARY KEY (COD),
    CONSTRAINT UK_USUARIOS UNIQUE KEY (CUENTA)
);

CREATE TABLE SER_AFIN
(
    COD_LIBRO VARCHAR(10) NOT NULL,
    COD_LIBRO_AFIN VARCHAR(10) NOT NULL,
    CONSTRAINT PK_SER_AFIN PRIMARY KEY (COD_LIBRO, COD_LIBRO_AFIN),
    CONSTRAINT FK_AFIN_LIBRO FOREIGN KEY (COD_LIBRO) REFERENCES LIBROS(COD),
    CONSTRAINT FK_AFIN_LIBRO_AFIN FOREIGN KEY (COD_LIBRO_AFIN) REFERENCES LIBROS(COD)
);

CREATE TABLE COMPRAR
(
    COD_USU VARCHAR(10) NOT NULL,
    COD_EJEM VARCHAR(10) NOT NULL,
    FECHA DATE NOT NULL,
    CONSTRAINT PK_COMPRAR PRIMARY KEY (COD_USU, COD_EJEM, FECHA),
    CONSTRAINT FK_COMPRAR_USUARIOS FOREIGN KEY (COD_USU) REFERENCES USUARIOS(COD),
    CONSTRAINT FK_COMPRAR_EJEMPLAR FOREIGN KEY (COD_EJEM) REFERENCES EJEMPLAR(COD)
);